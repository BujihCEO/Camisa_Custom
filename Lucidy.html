<!DOCTYPE html>
<html lang="en" style="font-size: calc(1 * 62.5%);">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="assets/custom_base.css">
    <title>Document</title>
</head>
<style>

.productWrap {
    --bg_1: url(assets/Lucidy_Bg_Botton_1.svg);
    --bg_2: url(assets/Lucidy_Bg_Botton_2.svg);
    --bg: var(--bg_1);
}

.GroupWrap {
    position: absolute;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
    width: 100%;
}

.starIcon {
    position: absolute;
    height: 100%;
    width: 100%;
    mask: url(assets/BG_Lucidy_Stars.svg) center/ cover no-repeat;
    background-color: var(--color);
}

.bg_2 {
    position: absolute;
    top: 79%;
    width: 100%;
    aspect-ratio: 52 / 5;
    mask: var(--bg) center / contain no-repeat;
    background: var(--color);
}

.textWrap.nome {
    position: absolute;
    display: flex;
    justify-content: center;
    top: 59%;
    width: 65%;
    font-size: 8%;
    line-height: initial;
    font-family: font_1;
    -webkit-text-stroke: 0.04em var(--color);
    text-transform: uppercase;
    white-space: nowrap;
    color: transparent;
}

.ImgWrap {
    height: 100%;
    width: 100%;
    mask: url(assets/BG_Lucidy_Stars_Mask.svg) center / cover,
        var(--textMask) center var(--textMask-top) / auto var(--textMask-height) no-repeat,
        linear-gradient(#000 0 0);
    mask-composite: exclude;
}

.imgContainer {
    position: absolute;
    top: 20%;
    height: 56%;
    width: 68%;
    border: 0.1rem solid var(--color);
}

.grid_1 {
    display: flex;
    aspect-ratio: 1 / 1.4;
}

.gridIconsBox {
    width: 50%;
}

.bgTemplate > * {
    width: 10rem;
    aspect-ratio: 2 / 1;
    margin: 0.5rem;
    background: var(--bg) right center / 430% no-repeat;
}

@font-face {
    font-family: font_1;
    src: url(assets/Lucidity_Psych.ttf) format('truetype');
}

</style>
<body>
    <div class="productWrap">
        <div class="Bg_Product">
            <div class="ProductBox">
                <div class="Preview">
                    <div class="ProductEdit">
                        <div class="GroupWrap">
                            <div class="ImgWrap"></div>
                            <div class="bg_2"></div>
                            <div class="starIcon"></div>
                            <div class="textWrap nome">
                                <div class="textReplace">Nome</div>
                            </div>
                        </div>
                    </div>
                    <div class="showLimits"></div>
                    <div class="dragSelector hidden">
                        <div class="dragMove"></div>
                    </div>
                </div>
            </div>
            <div class="MoveExmp"></div>
        </div>
        <div class="customBox">

            <div class="addOptionsBox"
                tittle="Cor Principal"
                colorBox="class={colorModeBox} color={#C841E5}"
            ></div>

            <div class="addImgBox"
            tittle="Foto"
            grid="qty={1}"
            process="potrace"
            ></div>
            
            <div class="inputTextBox"
            tittle="Nome"
            type="text" 
            data-XYlimited=""
            data-scaleX="true"
            addFunction="createTextMask"
            ></div>

            <div class="addOptionsBox"
                tittle="Texto"
                optionBox="qty={2} class={bgTemplate slider} att={--bg}"
            ></div>

        </div>
    </div>
</body>
<script src="assets/print.js"></script>
<script src="assets/jscolor.js"></script>
<script src="assets/potrace.js"></script>
<script>

var GroupWrap = document.querySelector('.GroupWrap');
var textWrap = document.querySelector('.textWrap.nome');
var textReplace = document.querySelector('.textReplace');
var editStyle = window.getComputedStyle(document.querySelector('.ProductEdit'));

function createTextMask() {
    var textStyle = window.getComputedStyle(textWrap);
    var replaceStyle = window.getComputedStyle(textReplace);
    
    var canvas = document.createElement('canvas');
    var ctx = canvas.getContext('2d');

    var scale = 4961 / parseFloat(editStyle.height);
    var transform = replaceStyle.getPropertyValue('transform');
    var scaleX = transform == 'none' ? 1 : transform.match(/matrix\(([^\s]*),/)[1];
    
    var textWidth = parseFloat(textStyle.width) * scale;
    var textHeight = parseFloat(textStyle.height) * scale;
    canvas.width = textWidth;
    canvas.height = textHeight;
    
    var fontSize = parseInt(replaceStyle.fontSize);
    var newFontSize = fontSize * scale;
    var font = replaceStyle.font.replace(/\d+px/, newFontSize + 'px');
    ctx.font = font;
    ctx.fillStyle = '#000';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';

    ctx.scale(scaleX, 1);
    ctx.fillText(textWrap.innerText, textWidth / (2 * scaleX), (textHeight / 2) + 70);
    GroupWrap.style.setProperty('--textMask', `url(${canvas.toDataURL()})`);
    GroupWrap.style.setProperty('--textMask-top', textStyle.top);
    GroupWrap.style.setProperty('--textMask-height', textStyle.height);
}

function resizeBefore() {
    editStyle = window.getComputedStyle(document.querySelector('.ProductEdit'));
    createTextMask();
}

</script>
<script src="assets/custom_base.js"></script>
<script src="assets/print_Estampa.js"></script>
</html>
